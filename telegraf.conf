[agent]
  interval = "10s"
  flush_interval = "5s"
  omit_hostname = true

# ==============================================================================
# BACnet Devices (via execd + Node.js Shim)
# ==============================================================================
# Verwendet BACNET_ADDRESS Umgebungsvariable (default: bacnet-simulator)
# ==============================================================================

[[inputs.execd]]
  command = ["node", "/opt/bacnet-shim/bacnet_shim.js", "--config", '{"interval":10,"batchSize":1000,"deviceRange":{"address":"${BACNET_ADDRESS}:47808","baseId":1234,"namePrefix":"elevator","count":10000,"instanceOffset":20,"tags":{"site":"test_labor"},"objects":["AI:0:current_floor","AI:1:target_floor","AI:2:direction","AI:3:speed","AI:4:position","AI:5:load_weight","AI:6:motor_temperature","AI:7:motor_current","AI:8:cabin_temperature","AI:9:trip_count","AI:10:door_cycles","AI:11:passenger_count","BI:0:door_open","BI:1:door_obstructed","BI:2:emergency_stop","BI:3:overload_warning","BI:4:overload","BI:5:safety_chain_ok","BI:6:brake_engaged","BI:7:maintenance_mode","BI:8:out_of_service","BI:9:cabin_light_on","BI:10:ventilation_on"]}}']
  environment = ["BACNET_ADDRESS=${BACNET_ADDRESS}"]
  signal = "none"
  restart_delay = "10s"
  data_format = "influx"

# --- OUTPUT: RabbitMQ (AMQP) ---
[[outputs.amqp]]
  brokers = ["amqp://${RABBITMQ_HOST}:5672/"]
  exchange = "iot_metrics"
  exchange_type = "topic"
  username = "user"
  password = "password"
  auth_method = "PLAIN"
  routing_tag = "asset_id"
  data_format = "json"

# --- OUTPUT: Debug (stdout) ---
[[outputs.file]]
  files = ["stdout"]
  data_format = "json"
